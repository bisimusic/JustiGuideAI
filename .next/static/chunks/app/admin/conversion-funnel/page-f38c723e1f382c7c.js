(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3062],{29938:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>k});var t=a(95155),l=a(12115),n=a(22454),r=a(96029),d=a(83209),i=a(97003),c=a(47507),o=a(55850),x=a(67812),m=a(1524),h=a(89559),u=a(91169),f=a(91761),j=a(26921),v=a(26265),p=a(4110),y=a(68425),N=a(47734),b=a(73697),g=a(10232),w=a(30759),R=a(69386);let C=["#3b82f6","#8b5cf6","#ec4899","#f97316","#10b981","#06b6d4"];function k(){let[e,s]=(0,l.useState)("all"),[a,k]=(0,l.useState)("30"),{data:L,isLoading:A,refetch:S}=(0,n.I)({queryKey:["/api/analytics/conversion-funnel",{platform:e,dateRange:a}],queryFn:async()=>{let s=new URLSearchParams({startDate:new Date(Date.now()-24*parseInt(a)*36e5).toISOString(),endDate:new Date().toISOString()});"all"!==e&&s.append("platform",e);let t=await fetch("/api/analytics/conversion-funnel?".concat(s));if(!t.ok)throw Error("Failed to fetch funnel data");return t.json()},refetchInterval:3e4}),Z=(null==L?void 0:L.funnel.map((e,s)=>({name:e.stage,value:e.uniqueLeads,conversionRate:e.conversionRate,dropoff:e.dropoffCount,fill:C[s%C.length]})))||[];return(0,t.jsxs)("div",{className:"flex min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,t.jsx)(r.A,{}),(0,t.jsx)("div",{className:"flex-1 ml-64",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(m.A,{className:"h-8 w-8 text-blue-600 mr-3"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100","data-testid":"heading-conversion-funnel",children:"Conversion Funnel Analytics"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Track Devvit → Booking → Payment journey with drop-off analysis"})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)(c.l6,{value:a,onValueChange:k,children:[(0,t.jsx)(c.bq,{className:"w-[140px]","data-testid":"select-daterange",children:(0,t.jsx)(c.yv,{placeholder:"Date range"})}),(0,t.jsxs)(c.gC,{children:[(0,t.jsx)(c.eb,{value:"7",children:"Last 7 days"}),(0,t.jsx)(c.eb,{value:"30",children:"Last 30 days"}),(0,t.jsx)(c.eb,{value:"90",children:"Last 90 days"})]})]}),(0,t.jsxs)(c.l6,{value:e,onValueChange:s,children:[(0,t.jsx)(c.bq,{className:"w-[140px]","data-testid":"select-platform",children:(0,t.jsx)(c.yv,{placeholder:"Platform"})}),(0,t.jsxs)(c.gC,{children:[(0,t.jsx)(c.eb,{value:"all",children:"All Platforms"}),(0,t.jsx)(c.eb,{value:"reddit",children:"Reddit"}),(0,t.jsx)(c.eb,{value:"linkedin",children:"LinkedIn"}),(0,t.jsx)(c.eb,{value:"calendly",children:"Calendly"})]})]}),(0,t.jsx)(i.$,{onClick:()=>S(),variant:"outline",size:"icon","data-testid":"button-refresh",children:(0,t.jsx)(h.A,{className:"h-4 w-4"})})]})]})}),A?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading funnel data..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,t.jsxs)(d.Zp,{"data-testid":"card-total-leads",children:[(0,t.jsx)(d.aR,{className:"pb-2",children:(0,t.jsx)(d.ZB,{className:"text-sm font-medium text-gray-600",children:"Total Leads"})}),(0,t.jsx)(d.Wu,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-3xl font-bold","data-testid":"text-total-leads",children:(null==L?void 0:L.summary.totalLeads.toLocaleString())||0}),(0,t.jsx)(u.A,{className:"h-8 w-8 text-blue-500"})]})})]}),(0,t.jsxs)(d.Zp,{"data-testid":"card-conversions",children:[(0,t.jsx)(d.aR,{className:"pb-2",children:(0,t.jsx)(d.ZB,{className:"text-sm font-medium text-gray-600",children:"Conversions"})}),(0,t.jsx)(d.Wu,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-3xl font-bold","data-testid":"text-conversions",children:(null==L?void 0:L.summary.totalConversions.toLocaleString())||0}),(0,t.jsx)(m.A,{className:"h-8 w-8 text-green-500"})]})})]}),(0,t.jsxs)(d.Zp,{"data-testid":"card-conversion-rate",children:[(0,t.jsx)(d.aR,{className:"pb-2",children:(0,t.jsx)(d.ZB,{className:"text-sm font-medium text-gray-600",children:"Conversion Rate"})}),(0,t.jsx)(d.Wu,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-3xl font-bold","data-testid":"text-conversion-rate",children:[(null==L?void 0:L.summary.overallConversionRate.toFixed(1))||0,"%"]}),(0,t.jsx)(x.E,{variant:((null==L?void 0:L.summary.overallConversionRate)||0)>5?"default":"destructive",children:((null==L?void 0:L.summary.overallConversionRate)||0)>5?"Good":"Low"})]})})]}),(0,t.jsxs)(d.Zp,{"data-testid":"card-total-revenue",children:[(0,t.jsx)(d.aR,{className:"pb-2",children:(0,t.jsx)(d.ZB,{className:"text-sm font-medium text-gray-600",children:"Total Revenue"})}),(0,t.jsx)(d.Wu,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-3xl font-bold","data-testid":"text-total-revenue",children:["$",((null==L?void 0:L.summary.totalRevenue)||0).toLocaleString()]}),(0,t.jsx)(f.A,{className:"h-8 w-8 text-green-500"})]})})]})]}),(0,t.jsxs)(d.Zp,{className:"mb-6",children:[(0,t.jsx)(d.aR,{children:(0,t.jsx)(d.ZB,{children:"Funnel Visualization"})}),(0,t.jsx)(d.Wu,{children:(0,t.jsx)(v.u,{width:"100%",height:300,children:(0,t.jsxs)(p.E,{data:Z,layout:"vertical",children:[(0,t.jsx)(y.d,{strokeDasharray:"3 3"}),(0,t.jsx)(N.W,{type:"number"}),(0,t.jsx)(b.h,{dataKey:"name",type:"category",width:150}),(0,t.jsx)(g.m,{}),(0,t.jsx)(w.yP,{dataKey:"value",radius:[0,8,8,0],children:Z.map((e,s)=>(0,t.jsx)(R.f,{fill:e.fill},"cell-".concat(s)))})]})})})]}),(0,t.jsxs)(d.Zp,{children:[(0,t.jsx)(d.aR,{children:(0,t.jsx)(d.ZB,{children:"Stage-by-Stage Analysis"})}),(0,t.jsx)(d.Wu,{children:(0,t.jsx)("div",{className:"space-y-6",children:null==L?void 0:L.funnel.map((e,s)=>(0,t.jsxs)("div",{className:"border-b pb-4 last:border-b-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:C[s%C.length]}}),(0,t.jsx)("h3",{className:"font-semibold text-lg",children:e.stage})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)(x.E,{variant:"outline","data-testid":"badge-leads-".concat(s),children:[e.uniqueLeads," leads"]}),s<(null==L?void 0:L.funnel.length)-1&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"→"}),(0,t.jsxs)(x.E,{variant:e.conversionRate>50?"default":"destructive",children:[e.conversionRate,"% convert"]})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4 mt-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Total Events"}),(0,t.jsx)("p",{className:"text-xl font-semibold","data-testid":"text-events-".concat(s),children:e.totalEvents})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Total Value"}),(0,t.jsxs)("p",{className:"text-xl font-semibold","data-testid":"text-value-".concat(s),children:["$",e.totalValue.toLocaleString()]})]}),s<(null==L?void 0:L.funnel.length)-1&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600 flex items-center",children:[(0,t.jsx)(j.A,{className:"h-4 w-4 mr-1 text-red-500"}),"Drop-off"]}),(0,t.jsxs)("p",{className:"text-xl font-semibold text-red-600","data-testid":"text-dropoff-".concat(s),children:[e.dropoffCount," (",e.dropoffRate,"%)"]})]})]}),s<(null==L?void 0:L.funnel.length)-1&&(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm mb-1",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Conversion to next stage"}),(0,t.jsxs)("span",{className:"font-medium",children:[e.conversionRate,"%"]})]}),(0,t.jsx)(o.k,{value:e.conversionRate,className:"h-2"})]})]},e.stage))})})]})]})]})})]})}},47507:(e,s,a)=>{"use strict";a.d(s,{bq:()=>m,eb:()=>j,gC:()=>f,l6:()=>o,yv:()=>x});var t=a(95155),l=a(12115),n=a(4729),r=a(24033),d=a(12108),i=a(5917),c=a(25016);let o=n.bL;n.YJ;let x=n.WT,m=l.forwardRef((e,s)=>{let{className:a,children:l,...d}=e;return(0,t.jsxs)(n.l9,{ref:s,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...d,children:[l,(0,t.jsx)(n.In,{asChild:!0,children:(0,t.jsx)(r.A,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=n.l9.displayName;let h=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.PP,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...l,children:(0,t.jsx)(d.A,{className:"h-4 w-4"})})});h.displayName=n.PP.displayName;let u=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.wn,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...l,children:(0,t.jsx)(r.A,{className:"h-4 w-4"})})});u.displayName=n.wn.displayName;let f=l.forwardRef((e,s)=>{let{className:a,children:l,position:r="popper",...d}=e;return(0,t.jsx)(n.ZL,{children:(0,t.jsxs)(n.UC,{ref:s,className:(0,c.cn)("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:r,...d,children:[(0,t.jsx)(h,{}),(0,t.jsx)(n.LM,{className:(0,c.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),(0,t.jsx)(u,{})]})})});f.displayName=n.UC.displayName,l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.JU,{ref:s,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...l})}).displayName=n.JU.displayName;let j=l.forwardRef((e,s)=>{let{className:a,children:l,...r}=e;return(0,t.jsxs)(n.q7,{ref:s,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...r,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(n.VF,{children:(0,t.jsx)(i.A,{className:"h-4 w-4"})})}),(0,t.jsx)(n.p4,{children:l})]})});j.displayName=n.q7.displayName,l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.wv,{ref:s,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...l})}).displayName=n.wv.displayName},55850:(e,s,a)=>{"use strict";a.d(s,{k:()=>d});var t=a(95155),l=a(12115),n=a(77450),r=a(25016);let d=l.forwardRef((e,s)=>{let{className:a,value:l,...d}=e;return(0,t.jsx)(n.bL,{ref:s,className:(0,r.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...d,children:(0,t.jsx)(n.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(l||0),"%)")}})})});d.displayName=n.bL.displayName},74085:(e,s,a)=>{Promise.resolve().then(a.bind(a,29938))}},e=>{e.O(0,[7349,1668,4622,2619,7429,4852,2494,3483,1204,3512,1592,245,8441,1255,7358],()=>e(e.s=74085)),_N_E=e.O()}]);