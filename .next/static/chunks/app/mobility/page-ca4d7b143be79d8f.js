(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2562],{25016:(e,t,s)=>{"use strict";s.d(t,{cn:()=>a});var i=s(2821),r=s(75889);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,i.$)(t))}},28171:(e,t,s)=>{"use strict";s.d(t,{dj:()=>m});var i=s(12115);let r=0,a=new Map,l=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},n=[],o={toasts:[]};function d(e){o=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?l(s):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(o,e),n.forEach(e=>{e(o)})}function c(e){let{...t}=e,s=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),i=()=>d({type:"DISMISS_TOAST",toastId:s});return d({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||i()}}}),{id:s,dismiss:i,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function m(){let[e,t]=i.useState(o);return i.useEffect(()=>(n.push(t),()=>{let e=n.indexOf(t);e>-1&&n.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},30870:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>D});var i=s(95155),r=s(12115),a=s(22454),l=s(80549),n=s(83209),o=s(97003),d=s(67812),c=s(55850),m=s(33789),u=s(90235),p=s(47507),x=s(28171),f=s(42529),h=s(26983),g=s(78874),v=s(17910),y=s(52508),b=s(52472),w=s(21786),j=s(89715),N=s(17181),I=s(38707),A=s(1524),T=s(48055),E=s(40260),S=s(95704);function D(){var e,t,s,D,C,R,_,M,k,K,W,P,F,L,O;let{toast:U}=(0,x.dj)(),[V,B]=(0,r.useState)(null),[z,Z]=(0,r.useState)("passport"),[J,Y]=(0,r.useState)(null),[G,q]=(0,r.useState)(!1),[$,H]=(0,r.useState)(!1),[X,Q]=(0,r.useState)(!1);(0,r.useEffect)(()=>{console.log("\uD83D\uDE80 [INIT] Starting World App detection...");let e=0,t=null,s=async()=>{e++,console.log("\uD83D\uDD0D [ATTEMPT ".concat(e,"/").concat(30,"] Checking World App environment..."));try{var t,s,i,r,a,l,n;let o=void 0!==window.WorldApp&&window.WorldApp,d=navigator.userAgent||"",c=d.includes("WorldApp")||d.includes("MiniKit"),m=o||c;if(console.log("\uD83D\uDCF1 [ENV] World App check:",{hasWorldAppObject:o,isWorldAppUA:c,userAgent:d.substring(0,50)+"...",isInWorldApp:m}),!m)return console.log("⚠️ [NOT_WORLD_APP] Not running in World App - verification unavailable"),q(!1),H(!1),!0;if(!(void 0!==window.MiniKit&&window.MiniKit)){if(console.log("⏳ [WAITING] World App detected, waiting for MiniKit SDK injection..."),e>=30)return console.error("❌ [TIMEOUT] MiniKit SDK never loaded in World App"),q(!0),H(!1),Q(!0),!0;return!1}if(console.log("✅ [SDK_FOUND] MiniKit object exists:",{type:typeof window.MiniKit,hasInstall:"function"==typeof window.MiniKit.install,hasCommands:void 0!==window.MiniKit.commands,hasVerify:"function"==typeof(null==(t=window.MiniKit.commands)?void 0:t.verify)}),window.MiniKit&&"function"==typeof window.MiniKit.install)try{console.log("\uD83D\uDD27 [INSTALL] Calling MiniKit.install() with options object...");let e=window.MiniKit;if(e&&e.install)await Promise.race([e.install({appId:"app_f0adeaeec4971994facf4c0be33a878f"}),new Promise((e,t)=>setTimeout(()=>t(Error("Install timeout after 10s")),1e4))]);else throw Error("MiniKit not available");console.log("✅ [INSTALL] MiniKit.install() completed successfully")}catch(t){if(console.error("❌ [INSTALL] Failed:",t),console.error("❌ [INSTALL] Error details:",{message:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0}),e>=30)return q(!0),H(!1),Q(!0),!0;return!1}let u=(null==(i=window.MiniKit)||null==(s=i.commands)?void 0:s.verify)&&"function"==typeof window.MiniKit.commands.verify;if(console.log("\uD83C\uDFAF [VERIFY_CHECK] Commands ready:",{hasCommands:void 0!==(null==(r=window.MiniKit)?void 0:r.commands),hasVerify:u}),u)return console.log("✅ [READY] MiniKit SDK fully ready - enabling verification!"),q(!0),H(!0),!0;if(e>=30)return console.error("❌ [TIMEOUT] MiniKit commands.verify never became available"),console.error("\uD83D\uDD0D [DEBUG] Final state:",{MiniKit:typeof window.MiniKit,commands:typeof(null==(a=window.MiniKit)?void 0:a.commands),verify:typeof(null==(n=window.MiniKit)||null==(l=n.commands)?void 0:l.verify)}),q(!0),H(!1),Q(!0),!0;return console.log("⏳ [WAITING] Commands not ready yet, will retry..."),!1}catch(t){if(console.error("❌ [ERROR] Detection failed:",t),e>=30)return console.error("❌ [TIMEOUT] Max attempts reached with errors"),q(!1),H(!1),!0;return!1}},i=()=>{t&&clearTimeout(t),s().then(s=>{!s&&e<30&&(t=setTimeout(i,e<=5?500:e<=15?1e3:2e3))})};return t=setTimeout(i,200),()=>{t&&clearTimeout(t)}},[]),(0,r.useEffect)(()=>{let e=localStorage.getItem("mobility_worldId");console.log("\uD83D\uDD0D Auto-login check:",{savedWorldId:e,hasCurrentUser:!!V}),e&&!V?(console.log("\uD83D\uDD04 Attempting auto-login with saved worldId...",e),fetch("/api/mobility/me?worldId=".concat(encodeURIComponent(e))).then(e=>(console.log("\uD83D\uDCCA Auto-login HTTP status:",e.status),e.json())).then(e=>{console.log("\uD83D\uDCCA Auto-login response:",e),e.success&&e.user?(B(e.user),console.log("✅ Auto-logged in returning user:",e.user.id)):console.log("❌ Auto-login failed:",e)}).catch(e=>{console.error("❌ Auto-login error:",e)})):e?V&&console.log("✅ Already logged in:",V.id):console.log("⚠️ No saved worldId found - user needs to verify")},[V]);let{data:ee,refetch:et}=(0,a.I)({queryKey:["/api/mobility/me",null==V?void 0:V.worldId],queryFn:async()=>{if(!(null==V?void 0:V.worldId))return null;let e=await fetch("/api/mobility/me?worldId=".concat(V.worldId)),t=await e.json();return t.success?t:null},enabled:!!(null==V?void 0:V.worldId)}),es=(0,l.n)({mutationFn:async()=>{let e=localStorage.getItem("mobility_worldId");if(!e)throw Error("No WorldID found to reset");let t=await fetch("/api/mobility/reset?worldId=".concat(encodeURIComponent(e)),{method:"DELETE"});if(!t.ok)throw Error((await t.json()).error||"Reset failed");return t.json()},onSuccess:e=>{localStorage.removeItem("mobility_worldId"),B(null),U({title:"✅ Data Reset Complete",description:e.message||"You can now verify again with a fresh start!"}),setTimeout(()=>window.location.reload(),1500)},onError:e=>{U({title:"Reset Failed",description:e.message,variant:"destructive"})}}),ei=(0,l.n)({mutationFn:async()=>{var e,t,s,i,r;console.log("\uD83D\uDE80 [VERIFY START] Initiating WorldID verification...");let a=S.env.NEXT_PUBLIC_VITE_WLD_ACTION||S.env.VITE_WLD_ACTION||"verify-human";if(!(null==(t=window.MiniKit)||null==(e=t.commands)?void 0:e.verify))throw console.error("\uD83D\uDD34 [SDK ERROR] MiniKit SDK not loaded or commands not ready"),console.error("\uD83D\uDD0D [DEBUG] window.MiniKit:",typeof window.MiniKit),console.error("\uD83D\uDD0D [DEBUG] window.MiniKit.commands:",typeof(null==(s=window.MiniKit)?void 0:s.commands)),console.error("\uD83D\uDD0D [DEBUG] window.MiniKit.commands.verify:",typeof(null==(r=window.MiniKit)||null==(i=r.commands)?void 0:i.verify)),Error("World ID SDK not ready. The verification system is still initializing. Please wait a few seconds and try again, or close and reopen the mini app.");return console.log("\uD83D\uDE80 [VERIFY START] Initiating WorldID verification..."),new Promise((e,t)=>{var s;if(!window.MiniKit)return void t(Error("MiniKit not available"));let i=window.MiniKit,r=i.subscribe(E.af.MiniAppVerifyAction,async s=>{console.log("\uD83D\uDCE6 [RAW RESPONSE]",JSON.stringify(s,null,2));try{var i;if(r(),"error"===s.status){console.error("❌ [ERROR]",s),t(Error(s.error_message||"Verification failed"));return}if(console.log("\uD83D\uDCE6 [PAYLOAD]",JSON.stringify(s,null,2)),!s.nullifier_hash){console.error("\uD83D\uDD34 [NO NULLIFIER]",s),t(Error("Invalid WorldID response: missing nullifier_hash"));return}console.log("\uD83D\uDD0D Checking if user already exists...");let l=await fetch("/api/mobility/me?worldId=".concat(encodeURIComponent(s.nullifier_hash))),n=await l.json();if(console.log("\uD83D\uDCCA Check response:",{status:l.status,data:n}),l.ok&&n.success&&n.user){console.log("✅ User already exists, auto-logging in..."),e(n);return}console.log("\uD83D\uDD35 [CLIENT] New user, proceeding with verification...");let o=await fetch("/api/mobility/worldid/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proof:s.proof,merkle_root:s.merkle_root,nullifier_hash:s.nullifier_hash,verification_level:s.verification_level,action:a,signal:""})});if(!o){console.error("❌ Verification response is undefined"),t(Error("Verification response is undefined"));return}let d=await o.json();if(!d){console.error("❌ Verification data is undefined"),t(Error("Verification data is undefined"));return}if(!o.ok&&(null==(i=d.error)?void 0:i.includes("already been verified"))){let t=await fetch("/api/mobility/me?worldId=".concat(encodeURIComponent(s.nullifier_hash))),i=await t.json();if(t.ok&&i.success)return void e(i)}e(d)}catch(e){t(e)}});console.log("\uD83C\uDFAF [TRIGGER] Calling window.MiniKit.commands.verify..."),(null==i||null==(s=i.commands)?void 0:s.verify)?i.commands.verify({action:a,signal:"",verification_level:"device"}):t(Error("MiniKit commands not available"))})},onSuccess:e=>{if(console.log("✅ Verification onSuccess called"),!e){console.error("❌ Verification response data is undefined"),U({title:"Verification Error",description:"No response received from verification. Please try again.",variant:"destructive"});return}if(console.log("\uD83D\uDCCA Full response:",JSON.stringify(e,null,2)),e.success&&e.user){var t,s;let i=e.user.worldId||e.user.world_id_nullifier;console.log("\uD83D\uDCBE User found:",{userId:e.user.id,worldId:i,hasScore:!!e.score}),B(e.user),console.log("✅ setCurrentUser called"),localStorage.setItem("mobility_worldId",i),console.log("✅ Saved to localStorage");let r=e.mobilityScore||(null==(t=e.score)?void 0:t.compositeScore)||(null==(s=e.score)?void 0:s.composite_score)||100;console.log("\uD83D\uDCCA Mobility score:",r),e.reward?U({title:e.reward.message,description:"Welcome! Your mobility score: ".concat(r)}):U({title:"✅ WorldID Verified!",description:"Welcome! Your mobility score: ".concat(r)}),console.log("\uD83D\uDD04 Refetching user data..."),setTimeout(()=>{et(),console.log("✅ User data refetch triggered")},100)}else{console.error("\uD83D\uDD34 [CLIENT] Verification response missing user data"),console.error("\uD83D\uDD34 [CLIENT] Full response data:",JSON.stringify(e,null,2)),console.error("\uD83D\uDD34 [CLIENT] success:",e.success,"| user exists:",!!e.user);let t="Verification completed but user data is missing.";e.success?e.user||(t="Server couldn't create your user account. Check the console for details."):t=e.error||"Verification failed on the server.",U({title:"Verification Issue",description:t+" Try the Reset button below or contact support.",variant:"destructive"})}},onError:e=>{U({title:"Verification Failed",description:e.message||"Unable to verify your WorldID. Please try again.",variant:"destructive"})}}),er=(0,l.n)({mutationFn:async e=>{let{userId:t,type:s,fileData:i,fileName:r}=e;return(await fetch("/api/mobility/credentials",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,type:s,fileData:i,fileName:r})})).json()},onSuccess:()=>{U({title:"\uD83D\uDCC4 Credential Uploaded!",description:"Your credential is being verified by AI..."}),Y(null),et(),setTimeout(()=>et(),3e3)}}),ea=async()=>{if(J&&V)try{let e=new FileReader;e.onloadend=()=>{er.mutate({userId:V.id,type:z,fileData:e.result,fileName:J.name})},e.onerror=()=>{U({title:"Upload Failed",description:"Failed to read file. Please try again.",variant:"destructive"})},e.readAsDataURL(J)}catch(e){U({title:"Upload Error",description:e instanceof Error?e.message:"An error occurred during upload",variant:"destructive"})}},el=(0,l.n)({mutationFn:async e=>{let{credentialId:t}=e;return(await fetch("/api/mobility/credentials/".concat(t,"/share"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({expiresInDays:30})})).json()},onSuccess:e=>{if(e.success){let t=e.share.shareUrl;navigator.clipboard.writeText(t),U({title:"Share Link Created",description:"Link copied to clipboard! Share expires in 30 days."})}},onError:e=>{U({title:"Share Failed",description:(null==e?void 0:e.message)||"Failed to create share link",variant:"destructive"})}}),{data:en}=(0,a.I)({queryKey:["/api/mobility/opportunities",null==ee||null==(e=ee.user)?void 0:e.id],enabled:!!(null==ee||null==(t=ee.user)?void 0:t.id)&&!!(null==ee?void 0:ee.score),queryFn:async()=>{var e;return(await fetch("/api/mobility/opportunities?userId=".concat(null==ee||null==(e=ee.user)?void 0:e.id))).json()}}),{data:eo,refetch:ed}=(0,a.I)({queryKey:["/api/mobility/rewards",null==ee||null==(s=ee.user)?void 0:s.id],enabled:!!(null==ee||null==(D=ee.user)?void 0:D.id),queryFn:async()=>{var e;return(await fetch("/api/mobility/rewards?userId=".concat(null==ee||null==(e=ee.user)?void 0:e.id))).json()}}),ec=(0,l.n)({mutationFn:async e=>(await fetch("/api/mobility/rewards/".concat(e,"/claim"),{method:"POST",headers:{"Content-Type":"application/json"}})).json(),onSuccess:e=>{if(e.success){var t;U({title:"Reward Claimed!",description:"Successfully claimed ".concat(null==(t=e.reward)?void 0:t.amount," WLD")}),ed()}},onError:e=>{U({title:"Claim Failed",description:(null==e?void 0:e.message)||"Failed to claim reward",variant:"destructive"})}});if(!V)return(0,i.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center p-4",children:(0,i.jsxs)(n.Zp,{className:"max-w-md w-full shadow-xl",children:[(0,i.jsxs)(n.aR,{className:"text-center pb-4",children:[(0,i.jsx)("div",{className:"mx-auto mb-4 w-20 h-20 bg-gradient-to-br from-blue-600 to-purple-600 rounded-full flex items-center justify-center",children:(0,i.jsx)(v.A,{className:"w-10 h-10 text-white"})}),(0,i.jsx)(n.ZB,{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"JustiGuide Mobility ID"}),(0,i.jsx)(n.BT,{className:"text-base mt-2",children:"Your Global Mobility Passport"})]}),(0,i.jsxs)(n.Wu,{className:"space-y-4",children:[(0,i.jsx)("div",{className:"border rounded-lg p-3 ".concat(G?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(y.A,{className:"w-5 h-5 ".concat(G?"text-green-600":"text-yellow-600")}),(0,i.jsx)("span",{className:"text-sm font-medium ".concat(G?"text-green-900":"text-yellow-900"),children:G?"✅ Running in World App":"⚠️ Best viewed in World App"})]})}),(0,i.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,i.jsxs)("h3",{className:"font-semibold text-blue-900 mb-2 flex items-center",children:[(0,i.jsx)(v.A,{className:"w-4 h-4 mr-2"}),"Privacy-First Verification"]}),(0,i.jsx)("p",{className:"text-sm text-blue-800",children:"WorldID uses zero-knowledge proofs. Your biometric data never leaves your device, ensuring complete privacy while proving you're human."})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("h3",{className:"font-semibold text-gray-900",children:"What you get:"}),(0,i.jsxs)("ul",{className:"space-y-2 text-sm",children:[(0,i.jsxs)("li",{className:"flex items-start",children:[(0,i.jsx)(f.A,{className:"w-4 h-4 text-green-500 mr-2 mt-0.5 flex-shrink-0"}),(0,i.jsx)("span",{children:"Start with 100-point mobility score"})]}),(0,i.jsxs)("li",{className:"flex items-start",children:[(0,i.jsx)(f.A,{className:"w-4 h-4 text-green-500 mr-2 mt-0.5 flex-shrink-0"}),(0,i.jsx)("span",{children:"Upload credentials to boost your score up to 1000"})]}),(0,i.jsxs)("li",{className:"flex items-start",children:[(0,i.jsx)(f.A,{className:"w-4 h-4 text-green-500 mr-2 mt-0.5 flex-shrink-0"}),(0,i.jsx)("span",{children:"AI-verified documents for trusted mobility profile"})]}),(0,i.jsxs)("li",{className:"flex items-start",children:[(0,i.jsx)(f.A,{className:"w-4 h-4 text-green-500 mr-2 mt-0.5 flex-shrink-0"}),(0,i.jsx)("span",{children:"Connect with immigration lawyers worldwide"})]})]})]}),$?(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)(o.$,{onClick:()=>ei.mutate(),disabled:ei.isPending,size:"lg",className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white","data-testid":"button-worldid-verify",children:[(0,i.jsx)(v.A,{className:"w-5 h-5 mr-2"}),ei.isPending?"Verifying...":"Verify with World ID"]}),!G&&(0,i.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[(0,i.jsx)("p",{className:"text-xs font-semibold text-yellow-900 mb-1",children:"⚠️ Best Experience in World App"}),(0,i.jsx)("p",{className:"text-xs text-yellow-800",children:"For optimal verification, open this in World App on your mobile device."})]})]}):X?(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)(o.$,{onClick:()=>window.location.reload(),size:"lg",className:"w-full bg-red-600 hover:bg-red-700 text-white","data-testid":"button-sdk-error",children:[(0,i.jsx)(v.A,{className:"w-5 h-5 mr-2"}),"Reload and Try Again"]}),(0,i.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[(0,i.jsx)("p",{className:"text-sm font-semibold text-red-900 mb-1",children:"❌ SDK Timeout"}),(0,i.jsx)("p",{className:"text-xs text-red-800 mb-2",children:"The verification system couldn't initialize. This usually happens if:"}),(0,i.jsxs)("ul",{className:"text-xs text-red-800 list-disc pl-4 space-y-1",children:[(0,i.jsx)("li",{children:"You're not using the latest World App version"}),(0,i.jsx)("li",{children:"The mini app needs to be reopened"}),(0,i.jsx)("li",{children:"Network connectivity issues"})]}),(0,i.jsx)("p",{className:"text-xs text-red-800 mt-2",children:'Try closing and reopening the mini app, or tap "Reload and Try Again" above.'})]})]}):(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)(o.$,{disabled:!0,size:"lg",className:"w-full bg-blue-400 text-white cursor-wait","data-testid":"button-sdk-loading",children:[(0,i.jsx)(v.A,{className:"w-5 h-5 mr-2 animate-pulse"}),"Initializing World ID..."]}),(0,i.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,i.jsx)("p",{className:"text-sm font-semibold text-blue-900 mb-1",children:"⏳ Loading SDK"}),(0,i.jsx)("p",{className:"text-xs text-blue-800",children:"Please wait while we initialize the verification system..."})]})]}),(0,i.jsx)("p",{className:"text-xs text-center text-gray-500",children:$?G?"Native verification using World ID":"World ID verification ready":"Initializing verification system..."})]})]})});let em=null==ee?void 0:ee.user,eu=(null==ee?void 0:ee.credentials)||[],ep=(null==ee?void 0:ee.score)||{composite_score:100},ex=(null==ee?void 0:ee.wldRewards)||{balance:0,transactions:[]};return(0,i.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,i.jsx)("header",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-6 sticky top-0 z-10 shadow-lg",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[(0,i.jsx)(v.A,{className:"w-6 h-6"}),"Mobility ID"]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,i.jsxs)(d.E,{className:"bg-green-500 text-xs",children:[(0,i.jsx)(f.A,{className:"w-3 h-3 mr-1"}),"Verified"]}),(0,i.jsxs)("span",{className:"text-xs text-blue-100","data-testid":"text-worldid",children:[null==em||null==(C=em.worldId)?void 0:C.substring(0,12),"..."]})]}),(0,i.jsx)("div",{className:"mt-2 bg-white/20 rounded-lg px-2 py-1 inline-block",children:(0,i.jsxs)("span",{className:"text-xs font-semibold","data-testid":"text-wld-balance",children:["\uD83D\uDCB0 ",ex.balance," WLD"]})})]}),(0,i.jsxs)("div",{className:"text-right",children:[(0,i.jsx)("div",{className:"text-4xl font-bold","data-testid":"text-mobility-score",children:ep.composite_score}),(0,i.jsx)("div",{className:"text-xs text-blue-100",children:"Score"}),(0,i.jsx)(o.$,{onClick:()=>es.mutate(),disabled:es.isPending,variant:"ghost",size:"sm",className:"mt-2 text-xs text-red-200 hover:text-red-100 hover:bg-white/10","data-testid":"button-reset-dashboard",children:es.isPending?"Resetting...":"\uD83D\uDDD1️ Reset"})]})]})}),(0,i.jsxs)("main",{className:"p-4 pb-20 space-y-4",children:[(0,i.jsxs)(n.Zp,{children:[(0,i.jsx)(n.aR,{className:"pb-3",children:(0,i.jsxs)(n.ZB,{className:"text-lg flex items-center",children:[(0,i.jsx)(b.A,{className:"w-5 h-5 mr-2"}),"Score Breakdown"]})}),(0,i.jsxs)(n.Wu,{className:"space-y-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex justify-between mb-1 text-sm",children:[(0,i.jsx)("span",{className:"font-medium",children:"Credentials"}),(0,i.jsxs)("span",{className:"text-gray-600","data-testid":"text-credentials-score",children:[(null==(R=ep.components)?void 0:R.credentials)||0," pts"]})]}),(0,i.jsx)(c.k,{value:((null==(_=ep.components)?void 0:_.credentials)||0)/4,className:"h-2"})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex justify-between mb-1 text-sm",children:[(0,i.jsx)("span",{className:"font-medium",children:"Verifications"}),(0,i.jsxs)("span",{className:"text-gray-600","data-testid":"text-verifications-score",children:[(null==(M=ep.components)?void 0:M.verifications)||0," pts"]})]}),(0,i.jsx)(c.k,{value:(null==(k=ep.components)?void 0:k.verifications)||0,className:"h-2"})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex justify-between mb-1 text-sm",children:[(0,i.jsx)("span",{className:"font-medium",children:"Engagement"}),(0,i.jsxs)("span",{className:"text-gray-600","data-testid":"text-engagement-score",children:[(null==(K=ep.components)?void 0:K.engagement)||0," pts"]})]}),(0,i.jsx)(c.k,{value:((null==(W=ep.components)?void 0:W.engagement)||0)/6,className:"h-2"})]})]})]}),(0,i.jsxs)(n.Zp,{children:[(0,i.jsxs)(n.aR,{className:"pb-3",children:[(0,i.jsxs)(n.ZB,{className:"text-lg flex items-center",children:[(0,i.jsx)(w.A,{className:"w-5 h-5 mr-2"}),"Upload Credential"]}),(0,i.jsx)(n.BT,{className:"text-sm",children:"Add documents to boost your score"})]}),(0,i.jsxs)(n.Wu,{className:"space-y-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(u.J,{htmlFor:"credential-type",className:"text-sm",children:"Credential Type"}),(0,i.jsxs)(p.l6,{value:z,onValueChange:Z,children:[(0,i.jsx)(p.bq,{id:"credential-type","data-testid":"select-credential-type",className:"mt-1",children:(0,i.jsx)(p.yv,{})}),(0,i.jsx)(p.gC,{children:[{value:"passport",label:"Passport",icon:"\uD83D\uDEC2",description:"National passport document"},{value:"visa",label:"Visa",icon:"✈️",description:"Travel or work visa"},{value:"degree",label:"University Degree",icon:"\uD83C\uDF93",description:"Bachelor's, Master's, PhD diploma"},{value:"employment_letter",label:"Employment Letter",icon:"\uD83D\uDCBC",description:"Proof of employment or offer letter"},{value:"certificate",label:"Professional Certificate",icon:"\uD83D\uDCDC",description:"Technical or professional certification"},{value:"license",label:"Professional License",icon:"⚖️",description:"Legal, medical, or professional license"},{value:"language_certificate",label:"Language Certificate",icon:"\uD83D\uDDE3️",description:"TOEFL, IELTS, or other language test"},{value:"work_permit",label:"Work Permit",icon:"\uD83D\uDCBC",description:"Employment authorization document"}].map(e=>(0,i.jsxs)(p.eb,{value:e.value,children:[e.icon," ",e.label]},e.value))})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(u.J,{htmlFor:"file-upload",className:"text-sm",children:"Upload File"}),(0,i.jsx)(m.p,{id:"file-upload",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:e=>{var t;return Y((null==(t=e.target.files)?void 0:t[0])||null)},"data-testid":"input-file-upload",className:"mt-1"}),J&&(0,i.jsx)("p",{className:"text-xs text-gray-600 mt-1","data-testid":"text-filename",children:J.name})]}),(0,i.jsxs)(o.$,{onClick:ea,disabled:!J||er.isPending,className:"w-full","data-testid":"button-upload-credential",children:[(0,i.jsx)(w.A,{className:"w-4 h-4 mr-2"}),er.isPending?"Uploading...":"Upload & Verify"]})]})]}),(0,i.jsxs)(n.Zp,{children:[(0,i.jsxs)(n.aR,{className:"pb-3",children:[(0,i.jsxs)(n.ZB,{className:"text-lg flex items-center",children:[(0,i.jsx)(j.A,{className:"w-5 h-5 mr-2"}),"Your Credentials"]}),(0,i.jsxs)(n.BT,{className:"text-sm",children:[eu.length," credential",1!==eu.length?"s":""]})]}),(0,i.jsx)(n.Wu,{children:0===eu.length?(0,i.jsxs)("div",{className:"text-center py-6 text-gray-500",children:[(0,i.jsx)(j.A,{className:"w-10 h-10 mx-auto mb-2 opacity-20"}),(0,i.jsx)("p",{className:"text-sm",children:"No credentials yet"}),(0,i.jsx)("p",{className:"text-xs mt-1",children:"Upload your first document above"})]}):(0,i.jsx)("div",{className:"space-y-2",children:eu.map(e=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-white","data-testid":"credential-".concat(e.id),children:[(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsx)("div",{className:"font-medium text-sm capitalize truncate",children:e.type.replace("_"," ")}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString()}),e.ai_score&&(0,i.jsxs)("div",{className:"text-xs text-blue-600 mt-1",children:["AI: ",(100*e.ai_score).toFixed(0),"%"]}),"rejected"===e.status&&e.rejected_reason&&(0,i.jsxs)("div",{className:"text-xs text-red-600 mt-1","data-testid":"rejection-reason-".concat(e.id),children:["❌ ",e.rejected_reason]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2 ml-2",children:["verified"===e.status&&(0,i.jsx)(o.$,{size:"sm",variant:"outline",onClick:()=>el.mutate({credentialId:e.id}),disabled:el.isPending,className:"h-8 px-2","data-testid":"button-share-".concat(e.id),children:(0,i.jsx)(N.A,{className:"w-4 h-4"})}),(e=>{switch(e){case"verified":return(0,i.jsxs)(d.E,{className:"bg-green-500","data-testid":"badge-verified",children:[(0,i.jsx)(f.A,{className:"w-3 h-3 mr-1"}),"Verified"]});case"pending":return(0,i.jsxs)(d.E,{className:"bg-yellow-500","data-testid":"badge-pending",children:[(0,i.jsx)(h.A,{className:"w-3 h-3 mr-1"}),"Pending"]});case"rejected":return(0,i.jsxs)(d.E,{variant:"destructive","data-testid":"badge-rejected",children:[(0,i.jsx)(g.A,{className:"w-3 h-3 mr-1"}),"Rejected"]});default:return(0,i.jsx)(d.E,{variant:"outline",children:"Unknown"})}})(e.status)]})]},e.id))})})]}),ep&&ep.composite_score>=300&&(0,i.jsxs)(n.Zp,{children:[(0,i.jsxs)(n.aR,{className:"pb-3",children:[(0,i.jsxs)(n.ZB,{className:"text-lg flex items-center",children:[(0,i.jsx)(I.A,{className:"w-5 h-5 mr-2"}),"Country Opportunities"]}),(0,i.jsxs)(n.BT,{className:"text-sm",children:["Based on your ",ep.composite_score,"-point mobility score"]})]}),(0,i.jsx)(n.Wu,{children:(null==en?void 0:en.success)&&(null==(P=en.opportunities)?void 0:P.length)>0?(0,i.jsx)("div",{className:"space-y-3",children:en.opportunities.map((e,t)=>(0,i.jsx)("div",{className:"p-3 border rounded-lg bg-gradient-to-r from-blue-50 to-purple-50","data-testid":"opportunity-".concat(t),children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"font-semibold text-sm flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-2xl",children:e.flag}),e.country]}),(0,i.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:[e.visaType," - ",e.difficulty]}),(0,i.jsx)("div",{className:"text-xs text-blue-700 mt-2",children:e.recommendation})]}),(0,i.jsxs)(d.E,{className:"bg-green-500",children:[(0,i.jsx)(A.A,{className:"w-3 h-3 mr-1"}),e.eligibilityScore,"%"]})]})},t))}):(0,i.jsxs)("div",{className:"text-center py-6 text-gray-500",children:[(0,i.jsx)(I.A,{className:"w-10 h-10 mx-auto mb-2 opacity-20"}),(0,i.jsx)("p",{className:"text-sm",children:"No opportunities yet"}),(0,i.jsx)("p",{className:"text-xs mt-1",children:"Upload more credentials to unlock destinations"})]})})]}),(0,i.jsxs)(n.Zp,{children:[(0,i.jsxs)(n.aR,{className:"pb-3",children:[(0,i.jsxs)(n.ZB,{className:"text-lg flex items-center",children:[(0,i.jsx)(T.A,{className:"w-5 h-5 mr-2"}),"WLD Rewards"]}),(0,i.jsx)(n.BT,{className:"text-sm",children:(null==eo?void 0:eo.success)?(0,i.jsxs)(i.Fragment,{children:[(null==(F=eo.summary)?void 0:F.totalEarned)||"0"," WLD earned • ",(null==(L=eo.summary)?void 0:L.totalPending)||"0"," WLD pending"]}):"Earn rewards for completing actions"})]}),(0,i.jsx)(n.Wu,{children:(null==eo?void 0:eo.success)&&(null==(O=eo.rewards)?void 0:O.length)>0?(0,i.jsx)("div",{className:"space-y-2",children:eo.rewards.map(e=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg ".concat("completed"===e.status?"bg-green-50 border-green-200":"pending"===e.status?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"),"data-testid":"reward-".concat(e.id),children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"font-medium text-sm",children:[e.amount," WLD"]}),(0,i.jsx)("div",{className:"text-xs text-gray-600",children:e.reason}),e.txHash&&(0,i.jsx)("div",{className:"text-xs text-blue-600 mt-1 font-mono truncate max-w-[200px]",children:e.txHash})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:["pending"===e.status&&(0,i.jsxs)(o.$,{size:"sm",onClick:()=>ec.mutate(e.id),disabled:ec.isPending,className:"h-8 px-3","data-testid":"button-claim-".concat(e.id),children:[(0,i.jsx)(T.A,{className:"w-3 h-3 mr-1"}),"Claim"]}),"completed"===e.status&&(0,i.jsx)(d.E,{className:"bg-green-500",children:"Claimed"}),"failed"===e.status&&(0,i.jsx)(d.E,{variant:"destructive",children:"Failed"})]})]},e.id))}):(0,i.jsxs)("div",{className:"text-center py-6 text-gray-500",children:[(0,i.jsx)(T.A,{className:"w-10 h-10 mx-auto mb-2 opacity-20"}),(0,i.jsx)("p",{className:"text-sm",children:"No rewards yet"}),(0,i.jsx)("p",{className:"text-xs mt-1",children:"Complete verifications to earn WLD"})]})})]})]})]})}},33789:(e,t,s)=>{"use strict";s.d(t,{p:()=>l});var i=s(95155),r=s(12115),a=s(25016);let l=r.forwardRef((e,t)=>{let{className:s,type:r,...l}=e;return(0,i.jsx)("input",{type:r,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...l})});l.displayName="Input"},47507:(e,t,s)=>{"use strict";s.d(t,{bq:()=>u,eb:()=>h,gC:()=>f,l6:()=>c,yv:()=>m});var i=s(95155),r=s(12115),a=s(4729),l=s(24033),n=s(12108),o=s(5917),d=s(25016);let c=a.bL;a.YJ;let m=a.WT,u=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,i.jsxs)(a.l9,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...n,children:[r,(0,i.jsx)(a.In,{asChild:!0,children:(0,i.jsx)(l.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=a.l9.displayName;let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)(a.PP,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,i.jsx)(n.A,{className:"h-4 w-4"})})});p.displayName=a.PP.displayName;let x=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)(a.wn,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,i.jsx)(l.A,{className:"h-4 w-4"})})});x.displayName=a.wn.displayName;let f=r.forwardRef((e,t)=>{let{className:s,children:r,position:l="popper",...n}=e;return(0,i.jsx)(a.ZL,{children:(0,i.jsxs)(a.UC,{ref:t,className:(0,d.cn)("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l,...n,children:[(0,i.jsx)(p,{}),(0,i.jsx)(a.LM,{className:(0,d.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,i.jsx)(x,{})]})})});f.displayName=a.UC.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)(a.JU,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=a.JU.displayName;let h=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,i.jsxs)(a.q7,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,i.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,i.jsx)(a.VF,{children:(0,i.jsx)(o.A,{className:"h-4 w-4"})})}),(0,i.jsx)(a.p4,{children:r})]})});h.displayName=a.q7.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)(a.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=a.wv.displayName},55850:(e,t,s)=>{"use strict";s.d(t,{k:()=>n});var i=s(95155),r=s(12115),a=s(77450),l=s(25016);let n=r.forwardRef((e,t)=>{let{className:s,value:r,...n}=e;return(0,i.jsx)(a.bL,{ref:t,className:(0,l.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...n,children:(0,i.jsx)(a.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});n.displayName=a.bL.displayName},67812:(e,t,s)=>{"use strict";s.d(t,{E:()=>n});var i=s(95155);s(12115);var r=s(83101),a=s(25016);let l=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n(e){let{className:t,variant:s,...r}=e;return(0,i.jsx)("div",{className:(0,a.cn)(l({variant:s}),t),...r})}},81201:(e,t,s)=>{Promise.resolve().then(s.bind(s,30870))},83209:(e,t,s)=>{"use strict";s.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>o,Zp:()=>l,aR:()=>n});var i=s(95155),r=s(12115),a=s(25016);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});l.displayName="Card";let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",s),...r})});n.displayName="CardHeader";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});o.displayName="CardTitle";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",s),...r})});d.displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",s),...r})});c.displayName="CardContent",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter"},90235:(e,t,s)=>{"use strict";s.d(t,{J:()=>d});var i=s(95155),r=s(12115),a=s(32894),l=s(83101),n=s(25016);let o=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)(a.b,{ref:t,className:(0,n.cn)(o(),s),...r})});d.displayName=a.b.displayName},97003:(e,t,s)=>{"use strict";s.d(t,{$:()=>d});var i=s(95155),r=s(12115),a=s(32467),l=s(83101),n=s(25016);let o=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:s,variant:r,size:l,asChild:d=!1,...c}=e,m=d?a.DX:"button";return(0,i.jsx)(m,{className:(0,n.cn)(o({variant:r,size:l,className:s})),ref:t,...c})});d.displayName="Button"}},e=>{e.O(0,[7349,1668,4622,7429,3483,1204,3512,3040,8441,1255,7358],()=>e(e.s=81201)),_N_E=e.O()}]);